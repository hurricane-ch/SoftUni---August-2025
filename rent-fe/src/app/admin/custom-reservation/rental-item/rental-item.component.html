

<main>
  <div class="relative pt-16 md:pb-20">
    <div
      class="absolute top-0 w-full h-full bg-center bg-cover bg-[url(/assets/images/start-page1.jpg)]"
    >
      <div class="w-full h-full absolute bg-black/40 backdrop-blur-sm"></div>
    </div>
  </div>

  <h3>
    <div class="w-full flex flex-col items-center text-center mt-12 mb-2">
      <div class="text-5xl mb-1 font-bold text-gray-800">
        {{ rentalItem?.name }}
      </div>

      <div class="text-lg space-y-2">
        <div class="flex gap-2 justify-center">
          <div class="text-gray-500">Стаи:</div>
          <div>
            {{ rentalItem?.room }}
          </div>
        </div>

        <div class="flex gap-2 justify-center">
          <div class="text-gray-500">Цена на вечер:</div>
          <div>
            {{ rentalItem?.price }}
          </div>
        </div>

        <div class="flex gap-2 justify-center">
          <div class="text-gray-500">Препоръчителен брой гости:</div>
          <div>
            {{ rentalItem?.recommendedVisitors }}
          </div>
        </div>
      </div>
    </div>
  </h3>

  <div class="container mx-auto flex flex-col p-4">
<div class="flex flex-col lg:flex-row gap-8 mt-2 mb-4">
      <div class="w-full">
        <div
          class="mb-4 rounded-lg overflow-hidden border border-gray-200 flex justify-center items-center"
        >
          <img
            id="mainPhoto"
            [src]="
              currentPhoto
                ? 'data:image/jpeg;base64,' + currentPhoto
                : 'https://placehold.co/600x400'
            "
            alt="{{ rentalItem?.name || 'Placeholder image' }}"
            class="object-cover w-full h-full hover:scale-105 transition-transform"
          />
        </div>

<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 pb-3">
          <!-- Main Image Thumbnail -->
          <div
            class="flex-1 h-56 rounded-lg overflow-hidden cursor-pointer border border-gray-200"
            (click)="setPhoto(originalMainPhoto)"
          >
            <img
              [src]="'data:image/jpeg;base64,' + originalMainPhoto"
              alt="Main Image"
              class="object-cover w-full h-full"
            />
          </div>

          <!-- Other thumbnails -->
          @for (attachment of rentalItem?.files; track $index) {
            <div
              class="flex-1 h-56 rounded-lg overflow-hidden cursor-pointer border border-gray-200"
              (click)="setPhoto(attachment)"
            >
              <img
                [src]="'data:image/jpeg;base64,' + attachment"
                alt="Attachment"
                class="object-cover w-full h-full"
              />
            </div>
          } @empty {
            <div
              class="flex-1 h-32 flex items-center justify-center border border-gray-200"
            >
              No photos
            </div>
          }
        </div>
      </div>
    </div>

    <app-calendar (selectedDatesChange)="onSelectedDatesChanged($event)" />

    <!-- Reservation Button -->
    <div class="flex justify-center py-20">
      <button
        #reserveButton
        type="button"
        class="flex items-center gap-2 text-white focus:outline-none focus:ring-4 focus:ring-green-300 text-lg rounded-full px-8 py-4"
        [ngClass]="{
          'cursor-pointer bg-green-700 hover:bg-green-800':
            selectedDates.length > 0,
          'cursor-not-allowed bg-gray-200': selectedDates.length === 0,
        }"
        [disabled]="selectedDates.length === 0"
        (click)="handleReservationClick()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m4.5 12.75 6 6 9-13.5"
          />
        </svg>
        Резервирай
      </button>
    </div>
  </div>

  <!-- Tooltip -->
</main>

@if (showTooltip) {
  <div
    class="absolute top-5 right-5 fixed z-50 flex items-center p-4 mb-4 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50"
    role="alert"
  >
    <svg
      class="shrink-0 inline w-4 h-4 me-3"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      viewBox="0 0 20 20"
    >
      <path
        d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"
      />
    </svg>
    <span class="sr-only">Info</span>
    <div>Моля, изберете дата!</div>
  </div>
}
